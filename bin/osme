#!/usr/bin/env node

console.log('running');

var COMMAND_NAME = '';

var COUNTRY='';
var ADMIN_LEVEL = 2;
var EPSILON = 50;

var options = process.argv.slice(2);

COMMAND_NAME = options.shift();

if (['scan', 'export'].indexOf(COMMAND_NAME) === -1) {
    console.log('Error: unknown command "' + COMMAND_NAME + '"');
    process.exit(1);
}

while (options.length > 0) {
    var v = options.shift();
    switch (v) {
        case "-country":
            COUNTRY = options.shift().split(',');
            break;
        case "-al":
            ADMIN_LEVEL = options.shift();
            break;
        case "-e":
            EPSILON = options.shift();
            break;
        case '-h':
        case '--help':
            console.log([
                'Common options:',
                '  -e              simplification epsilon [200]',
                'Command:',
                '  rel             load relation by id',
                '    options:',
                '      -id         id',
                '  subrel          load sub relation by parent relation id',
                '    options:',
                '      -p          parent releation id',
                '      -al         admin_level for sub relation [3]',
                '  help            print this help'
            ].join('\n'));
            process.exit(1);
            break;
    }
}

var lib = require('./../lib');

if (COMMAND_NAME == 'scan') {
    lib.scan({
      adminLevel:ADMIN_LEVEL,
      country: COUNTRY
    }, function(){
    lib.end();
    });
}

if (COMMAND_NAME == 'export') {
    require('./../lib').export({
      adminLevel:ADMIN_LEVEL,
      country: COUNTRY
    }, EPSILON);
}