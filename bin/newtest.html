<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Визуализатор данных регионов</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript"
            src="http://api-maps.yandex.ru/2.0/?lang=ru-RU&load=package.full,util.math.bounds,util.coordinates.decode&mode=debug"></script>
    <script type="text/javascript" src="regions.js"></script>
    <script type="text/javascript" src="../tmp-data/osme.json"></script>
    <script type="text/javascript" src="http://yandex.st/jquery/1.8.2/jquery.min.js"></script>
</head>

<body class="yui3-skin-sam">
<table width=100% height=800>
    <tr valign=top>
        <td>
            <div id="map" style="height: 700px; width: 100%; position: relative;"></div>
            <div id='waypoints'></div>
        </td>
    </tr>
</table>

</body>

<script type="text/javascript">
    ymaps.ready(function () {
        var geoMap = new ymaps.Map('map', {
            center: [0, 0],
            type: "yandex#hybrid",
            zoom: 2
        });

        for (var i in osme.regions) {
            if (1 || i == 1428125) {
                var geometry = regions.getGeometry(i, osme);

                for (var j in geometry.coordinates) {
                    if (geometry.coordinates[j].length) {
                        var v1 = geometry.coordinates[j][0],
                                v2 = geometry.coordinates[j][geometry.coordinates[j].length - 1],
                                d = [Math.abs(v1[0] - v2[0]), Math.abs(v1[1] - v2[1])],
                                dist = d[0] * d[0] + d[1] * d[1],
                                bounds = ymaps.util.math.bounds.fromPoints(geometry.coordinates[j]),
                                dim = ymaps.util.math.bounds.dimension(bounds);

                        //console.log(j, dist, d, dim);
                        if (d[0] < dim[0] * 0.5 && d[1] < dim[1] * 0.5) {
                            var region = new ymaps.GeoObject({
                                geometry: {
                                    type: 'Polygon',
                                    //type: 'LineString',
                                    fillRule: 'nonZero',
                                    //coordinates: geometry.coordinates[j]
                                    coordinates: [geometry.coordinates[j]]
                                },
                                properties: {
                                    hintContent: i + ":" + j + ":" + osme.regions[i].name
                                }
                            }, {
                                opacity: 0.5,
                                fillColor: j % 2 ? '#0066ff' : '#ff0000',
                                strokeColor: j % 2 ? '#ffff00' : '#00ffff',
                                strokeWidth: 3
                            });
                            geoMap.geoObjects.add(region);

                        }
                    } else {
                        console.log(i, osme.regions[i].name, 'error geometry', j);
                    }
                }
            }
        }
    });
</script>
</html>
