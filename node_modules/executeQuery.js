var queryCounter=0;

function Query (callback) {
    var counter = 0;
    var id=queryCounter++;
    this.id=id;
    this.push = function () {
        counter++;
    }
    this.pop = function () {
        counter--;
        if (!counter) {
            callback();
            callback=null;
        }
    };
    return this;
}

exports.createQuery = function(callback){
    return new Query(callback);
}